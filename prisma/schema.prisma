// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Utilise le systÃ¨me d'auth de Supabase
model User {
  id        String   @id // UUID de Supabase auth.users
  email     String   @unique
  firstName String?
  lastName  String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  watchlist     WatchlistItem[]
  watchedSeries WatchedSerie[]
  ratings       Rating[]
  preferences   UserPreferences?

  @@map("users")
}

model UserPreferences {
  id               String @id @default(cuid())
  userId           String @unique
  favoriteGenres   Int[]  // Array of TMDB genre IDs
  favoriteActors   Int[]  // Array of TMDB person IDs
  minRating        Float  @default(7.0)
  preferredLanguage String @default("fr-FR")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

model WatchlistItem {
  id        String   @id @default(cuid())
  userId    String
  serieId   Int      // TMDB ID
  serieName String
  serieData Json     // Store complete TMDB serie data
  addedAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, serieId])
  @@map("watchlist_items")
}

model WatchedSerie {
  id          String   @id @default(cuid())
  userId      String
  serieId     Int      // TMDB ID
  serieName   String
  serieData   Json     // Store complete TMDB serie data
  watchedAt   DateTime @default(now())
  seasonsWatched Int[] @default([]) // Array of season numbers watched
  episodesWatched Json @default("{}") // JSON object with season -> episodes mapping
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, serieId])
  @@map("watched_series")
}

model Rating {
  id        String   @id @default(cuid())
  userId    String
  serieId   Int      // TMDB ID
  rating    Float    // 0.5 to 10
  review    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, serieId])
  @@map("ratings")
}
